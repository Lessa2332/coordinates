<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AR –°–≤—ñ—Ç –ó–û–® ‚Ññ6 ‚Äî –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ñ –æ–ø–∞–¥–∏</title>
    
    <!-- –°—Ç–∞–±—ñ–ª—å–Ω—ñ –≤–µ—Ä—Å—ñ—ó A-Frame —Ç–∞ AR.js (–ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ) -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            touch-action: none;
        }
        /* –í—ñ–¥–µ–æ –Ω–∞ –≤–µ—Å—å –µ–∫—Ä–∞–Ω (AR.js –≤–±—É–¥—É—î –π–æ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ, –∞–ª–µ –¥–ª—è –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ) */
        .arjs-video {
            object-fit: cover !important;
        }
        /* –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–≤–µ—Ä—Ö AR */
        .ui-panel {
            position: fixed;
            top: env(safe-area-inset-top, 16px);
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 440px;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(12px);
            color: #111;
            padding: 16px 20px;
            border-radius: 32px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.5);
            z-index: 1000;
            pointer-events: none;
        }
        #instruction {
            font-size: 18px;
            font-weight: 600;
            line-height: 1.3;
            margin-bottom: 6px;
        }
        #distance-badge {
            display: inline-block;
            background: #4facfe;
            color: white;
            padding: 5px 16px;
            border-radius: 40px;
            font-size: 15px;
            font-weight: 700;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        .controls {
            position: fixed;
            bottom: env(safe-area-inset-bottom, 24px);
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 12px;
            z-index: 1000;
            pointer-events: none;
        }
        .btn {
            background: rgba(255, 255, 255, 0.95);
            border: none;
            padding: 14px 22px;
            border-radius: 28px;
            font-weight: 700;
            font-size: 16px;
            color: #111;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            display: flex;
            align-items: center;
            gap: 8px;
            pointer-events: auto;
            transition: transform 0.1s ease, background 0.2s;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.6);
        }
        .btn:active { transform: scale(0.96); }
        .btn.active {
            background: #4facfe;
            color: white;
        }
        .arjs-loader {
            background: #1a2a3a;
            color: white;
            font-weight: 600;
            z-index: 3000;
        }
        /* –¢–∏–º—á–∞—Å–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ */
        .toast-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.85);
            color: white;
            padding: 16px 32px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 20px;
            z-index: 10000;
            box-shadow: 0 12px 30px black;
            backdrop-filter: blur(4px);
            border: 2px solid #4facfe;
            transition: opacity 0.3s;
            pointer-events: none;
        }
        @media (max-width: 480px) {
            .btn { padding: 12px 18px; font-size: 15px; }
            #instruction { font-size: 16px; }
        }
    </style>
</head>
<body>

    <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∞ –ø–∞–Ω–µ–ª—å –∑–≤–µ—Ä—Ö—É -->
    <div class="ui-panel" id="uiPanel">
        <div id="instruction">üåç –®—É–∫–∞—î–º–æ GPS —Ç–∞ –∫–∞–º–µ—Ä—É‚Ä¶</div>
        <div id="distance-badge">‚Äî –º</div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è -->
    <div class="controls">
        <button id="quizBtn" class="btn">üìã –¢–µ—Å—Ç (12)</button>
        <button id="soundBtn" class="btn">üîä –ó–≤—É–∫</button>
        <button id="refreshBtn" class="btn">üîÑ GPS</button>
    </div>

    <!-- A-Frame AR scene -->
    <a-scene
        id="scene"
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best; videoTexture: true;"
        renderer="antialias: true; alpha: true; logarithmicDepthBuffer: true; precision: medium;"
        keyboard-shortcuts="enabled: false"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%;"
    >
        <a-assets>
            <!-- –¢–µ–∫—Å—Ç—É—Ä–∞ –ó–µ–º–ª—ñ (–∑–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π —Ñ–∞–π–ª –∞–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –æ–Ω–ª–∞–π–Ω) -->
            <img id="earthTexture" src="https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg" crossorigin="anonymous">
            <!-- –§–æ–Ω–æ–≤–∞ –º—É–∑–∏–∫–∞ (—Ç–∏—Ö–∞, –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–∞) ‚Äì –∑–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ –≤–ª–∞—Å–Ω–∏–π mp3 -->
            <audio id="bgMusic" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" preload="auto" loop crossorigin="anonymous"></audio>
        </a-assets>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–ª–∞–Ω–µ—Ç–∏, –ø—Ä–∏–≤'—è–∑–∞–Ω–∏–π –¥–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —à–∫–æ–ª–∏ -->
        <a-entity
            id="planetContainer"
            gps-entity-place="latitude: 46.297082; longitude: 30.650495;"
            position="0 1.2 0"
        >
            <!-- –°–∞–º–∞ –ø–ª–∞–Ω–µ—Ç–∞ (–∫—É–ª—è) -->
            <a-sphere
                id="planet"
                radius="2.5"
                src="#earthTexture"
                material="shader: flat;"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 30000; easing: linear"
                visible="false"
            ></a-sphere>

            <!-- 3D-–≤—ñ–∫—Ç–æ—Ä–∏–Ω–∞ (–±—É–¥–µ –ø–æ–∫–∞–∑–∞–Ω–∞ –æ–∫—Ä–µ–º–æ) -->
            <a-entity id="quizContainer" position="3 1.8 -1" scale="0.8 0.8 0.8" visible="false">
                <!-- –§–æ–Ω–æ–≤–∞ –ø–ª–∞—à–∫–∞ -->
                <a-plane width="4.2" height="3.5" color="#ffffff" opacity="0.95" material="side: double; transparent: true" position="0 0 -0.1"></a-plane>
                <!-- –¢–µ–∫—Å—Ç –∑–∞–ø–∏—Ç–∞–Ω–Ω—è (–¥–∏–Ω–∞–º—ñ—á–Ω–æ –∑–º—ñ–Ω—é—î—Ç—å—Å—è —á–µ—Ä–µ–∑ JS) -->
                <a-text id="questionText" value="–ó–∞–ø–∏—Ç–∞–Ω–Ω—è 1/12" color="#111" align="center" position="0 1.4 0" width="3.8" wrap-count="20" baseline="top" font="roboto"></a-text>
                <!-- –ö–Ω–æ–ø–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π -->
                <a-entity id="answerA" class="clickable" position="-0.9 0.3 0" scale="1 1 1" onclick="handleAnswer(0)">
                    <a-plane width="1.9" height="0.7" color="#4facfe" material="side: double; transparent: true" radius="0.15"></a-plane>
                    <a-text id="answerAText" value="–í–∞—Ä—ñ–∞–Ω—Ç –ê" color="white" align="center" position="0 0 0.05" width="1.8"></a-text>
                </a-entity>
                <a-entity id="answerB" class="clickable" position="0.9 0.3 0" onclick="handleAnswer(1)">
                    <a-plane width="1.9" height="0.7" color="#4facfe" material="side: double; transparent: true" radius="0.15"></a-plane>
                    <a-text id="answerBText" value="–í–∞—Ä—ñ–∞–Ω—Ç –ë" color="white" align="center" position="0 0 0.05" width="1.8"></a-text>
                </a-entity>
                <!-- –ö–Ω–æ–ø–∫–∞ "–î–∞–ª—ñ" (–∑'—è–≤–ª—è—î—Ç—å—Å—è –ø—ñ—Å–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ) -->
                <a-entity id="nextBtn" class="clickable" position="0 -0.9 0" visible="false" onclick="nextQuestion()">
                    <a-plane width="1.5" height="0.6" color="#ffaa00" material="side: double;" radius="0.2"></a-plane>
                    <a-text value="‚ñ∂ –î–∞–ª—ñ" color="white" align="center" position="0 0 0.05" width="1.4"></a-text>
                </a-entity>
                <!-- –õ—ñ—á–∏–ª—å–Ω–∏–∫ (–¥—É–±–ª—é—î—Ç—å—Å—è –≤ —Ç–µ–∫—Å—Ç—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è, –∞–ª–µ –º–æ–∂–Ω–∞ —ñ –æ–∫—Ä–µ–º–æ) -->
            </a-entity>
        </a-entity>

        <!-- –ö–∞–º–µ—Ä–∞ –∑ GPS —Ç–∞ –∫—É—Ä—Å–æ—Ä–æ–º -->
        <a-camera id="camera" gps-camera="minDistance: 1; maxDistance: 500;" rotation-reader>
            <a-cursor color="#4facfe" scale="0.7 0.7 0.7" fuse="false"></a-cursor>
        </a-camera>
    </a-scene>

    <script>
        (function() {
            // ======================== –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ========================
            const DEV_MODE = false; // –ó–º—ñ–Ω–∏—Ç–∏ –Ω–∞ false –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ä–µ–∞–ª—å–Ω–∏–º GPS
            const TARGET_LAT = 46.297082;
            const TARGET_LON = 30.650495;
            const MAX_DISTANCE = 30; // –º–µ—Ç—Ä—ñ–≤, –Ω–∞ —è–∫–∏—Ö –ø–ª–∞–Ω–µ—Ç–∞ —Å—Ç–∞—î –≤–∏–¥–∏–º–æ—é

            // ======================== 12 –ó–ê–ü–ò–¢–ê–ù–¨ ========================
            const questions = [
                { q: "–Ø–∫—ñ –æ–ø–∞–¥–∏ –≤–∏–ø–∞–¥–∞—é—Ç—å —É –≤–∏–≥–ª—è–¥—ñ –∫—É–ª—å–æ–∫ –ª—å–æ–¥—É?", a: "–ì—Ä–∞–¥", b: "–°–Ω—ñ–≥", correct: 0 },
                { q: "–©–æ —É—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –ø—Ä–∏ –∫–æ–Ω–¥–µ–Ω—Å–∞—Ü—ñ—ó –ø–∞—Ä–∏ –Ω–∞ —Ö–æ–ª–æ–¥–Ω—ñ–π –ø–æ–≤–µ—Ä—Ö–Ω—ñ –≤–ª—ñ—Ç–∫—É?", a: "–†–æ—Å–∞", b: "–Ü–Ω—ñ–π", correct: 0 },
                { q: "–°–Ω—ñ–≥ ‚Äî —Ü–µ...", a: "–õ—å–æ–¥—è–Ω—ñ –∫—Ä–∏—Å—Ç–∞–ª–∏–∫–∏", b: "–ó–∞–º–µ—Ä–∑–ª–∏–π –¥–æ—â", correct: 0 },
                { q: "–Ø–∫—ñ –æ–ø–∞–¥–∏ –≤–∏–ø–∞–¥–∞—é—Ç—å –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑ –Ω–∞—Å–∏—á–µ–Ω–æ–≥–æ –ø–æ–≤—ñ—Ç—Ä—è?", a: "–¢—É–º–∞–Ω, —Ä–æ—Å–∞, —ñ–Ω—ñ–π", b: "–î–æ—â, —Å–Ω—ñ–≥, –≥—Ä–∞–¥", correct: 0 },
                { q: "–Ø–∫ –Ω–∞–∑–∏–≤–∞—é—Ç—å—Å—è —Ç–≤–µ—Ä–¥—ñ –Ω–µ–ø—Ä–æ–∑–æ—Ä—ñ –ª—å–æ–¥—è–Ω—ñ –∫—Ä—É–ø–∏–Ω–∫–∏?", a: "–ö—Ä—É–ø–∞", b: "–ì—Ä–∞–¥", correct: 0 },
                { q: "–ö–æ–ª–∏ –Ω–∞–π—á–∞—Å—Ç—ñ—à–µ –≤–∏–ø–∞–¥–∞—î –≥—Ä–∞–¥?", a: "–í–∑–∏–º–∫—É", b: "–£–ª—ñ—Ç–∫—É –ø—ñ–¥ —á–∞—Å –≥—Ä–æ–∑–∏", correct: 1 },
                { q: "–°—É–º—ñ—à –ø–∏–ª—É, –¥–∏–º—É –π —Ç—É–º–∞–Ω—É ‚Äî —Ü–µ...", a: "–°–µ—Ä–ø–∞–Ω–æ–∫", b: "–°–º–æ–≥", correct: 1 },
                { q: "–Ø–∫–µ —è–≤–∏—â–µ –∑–Ω–∞—á–Ω–æ –∑–º–µ–Ω—à—É—î –≤–∏–¥–∏–º—ñ—Å—Ç—å –∑—Ä–∞–Ω–∫—É?", a: "–¢—É–º–∞–Ω", b: "–†–æ—Å–∞", correct: 0 },
                { q: "–©–æ —î –ø—Ä–∏—á–∏–Ω–æ—é —É—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ—â—É?", a: "–ö–æ–Ω–¥–µ–Ω—Å–∞—Ü—ñ—è —ñ –∑–ª–∏—Ç—Ç—è –∫—Ä–∞–ø–µ–ª—å", b: "–ó–∞–º–µ—Ä–∑–∞–Ω–Ω—è –ø–∞—Ä–∏", correct: 0 },
                { q: "–Ø–∫—ñ –æ–ø–∞–¥–∏ –Ω–∞–ª–µ–∂–∞—Ç—å –¥–æ —Ç–≤–µ—Ä–¥–∏—Ö (–∑ —Ö–º–∞—Ä)?", a: "–°–Ω—ñ–≥, –≥—Ä–∞–¥, –∫—Ä—É–ø–∞", b: "–î–æ—â, —Ä–æ—Å–∞", correct: 0 },
                { q: "–Ü–Ω—ñ–π —É—Ç–≤–æ—Ä—é—î—Ç—å—Å—è, –∫–æ–ª–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ–≤–µ—Ä—Ö–Ω—ñ...", a: "–í–∏—â–∞ 0¬∞C", b: "–ù–∏–∂—á–∞ 0¬∞C", correct: 1 },
                { q: "–ö–æ—Ä–æ—Ç–∫–æ—á–∞—Å–Ω—ñ —ñ–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ –æ–ø–∞–¥–∏ –Ω–∞–∑–∏–≤–∞—é—Ç—å...", a: "–ó–ª–∏–≤–∞", b: "–ú—Ä—è–∫–∞", correct: 0 }
            ];

            let currentQuestionIndex = 0;
            let answered = false; // —á–∏ –≤—ñ–¥–ø–æ–≤—ñ–ª–∏ –Ω–∞ –ø–æ—Ç–æ—á–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è (—â–æ–± –Ω–µ –º–æ–∂–Ω–∞ –±—É–ª–æ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ –¥–≤—ñ—á—ñ)
            let score = 0; // –º–æ–∂–Ω–∞ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, –∞–ª–µ –¥–ª—è —Ü—ñ–∫–∞–≤–æ—Å—Ç—ñ

            // ======================== –ï–õ–ï–ú–ï–ù–¢–ò DOM ========================
            const uiPanel = document.getElementById('uiPanel');
            const instructionEl = document.getElementById('instruction');
            const distanceBadge = document.getElementById('distance-badge');
            const quizBtn = document.getElementById('quizBtn');
            const soundBtn = document.getElementById('soundBtn');
            const refreshBtn = document.getElementById('refreshBtn');
            const planet = document.getElementById('planet');
            const quizContainer = document.getElementById('quizContainer');
            const questionText = document.getElementById('questionText');
            const answerAText = document.getElementById('answerAText');
            const answerBText = document.getElementById('answerBText');
            const nextBtn = document.getElementById('nextBtn');
            const bgMusic = document.getElementById('bgMusic');

            // ======================== –°–¢–ê–ù ========================
            let isSoundOn = false;
            let gpsWatcher = null;
            let lastDistance = null;

            // ======================== –î–û–ü–û–ú–Ü–ñ–ù–Ü –§–£–ù–ö–¶–Ü–á ========================
            function showToast(msg, isSuccess = true) {
                const toast = document.createElement('div');
                toast.className = 'toast-message';
                toast.style.background = isSuccess ? '#2e7d32' : '#c62828';
                toast.innerText = msg;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 1500);
            }

            // –û–±—á–∏—Å–ª–µ–Ω–Ω—è –≤—ñ–¥—Å—Ç–∞–Ω—ñ (–≥–∞–≤–µ—Ä—Å–∏–Ω—É—Å)
            function calculateDistance(lat1, lon1, lat2, lon2) {
                const R = 6371e3;
                const œÜ1 = lat1 * Math.PI/180;
                const œÜ2 = lat2 * Math.PI/180;
                const ŒîœÜ = (lat2-lat1) * Math.PI/180;
                const ŒîŒª = (lon2-lon1) * Math.PI/180;
                const a = Math.sin(ŒîœÜ/2) * Math.sin(ŒîœÜ/2) +
                          Math.cos(œÜ1) * Math.cos(œÜ2) *
                          Math.sin(ŒîŒª/2) * Math.sin(ŒîŒª/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                return R * c;
            }

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–∏–¥–∏–º–æ—Å—Ç—ñ –ø–ª–∞–Ω–µ—Ç–∏ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –≤—ñ–¥—Å—Ç–∞–Ω—ñ
            function updatePlanetVisibility(dist) {
                const rounded = Math.round(dist);
                distanceBadge.innerText = rounded + ' –º';
                if (dist <= MAX_DISTANCE) {
                    planet.setAttribute('visible', 'true');
                    instructionEl.innerText = 'üåç –ü–ª–∞–Ω–µ—Ç–∞ –ø–æ—Ä—É—á! –î–∏–≤–∏—Å—å –Ω–∞–≤–∫–æ–ª–æ';
                    distanceBadge.style.background = '#4ade80';
                } else {
                    planet.setAttribute('visible', 'false');
                    instructionEl.innerText = 'üèÉ –ù–∞–±–ª–∏–∑—å—Ç–µ—Å—å –¥–æ —à–∫–æ–ª–∏ (30 –º)';
                    distanceBadge.style.background = '#ff6b6b';
                }
            }

            // –û–±—Ä–æ–±–Ω–∏–∫ –ø–æ–¥—ñ—ó AR.js (–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ—ó GPS)
            window.addEventListener('gps-entity-place-update-position', (e) => {
                if (DEV_MODE) return;
                const dist = e.detail.distance;
                if (dist) updatePlanetVisibility(dist);
            });

            // –Ø–∫—â–æ DEV_MODE, —Å–∏–º—É–ª—é—î–º–æ –Ω–µ–≤–µ–ª–∏–∫—É –≤—ñ–¥—Å—Ç–∞–Ω—å
            if (DEV_MODE) {
                console.log('üß™ –†–ï–ñ–ò–ú –†–û–ó–†–û–ë–ù–ò–ö–ê: —Å–∏–º—É–ª—è—Ü—ñ—è GPS');
                setTimeout(() => {
                    updatePlanetVisibility(5);
                }, 2000);
            }

            // –ó–∞–ø–∏—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ GPS
            function startGPS() {
                if (!navigator.geolocation) {
                    instructionEl.innerText = '‚ùå GPS –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è';
                    return;
                }
                instructionEl.innerText = 'üì° –û—Ç—Ä–∏–º–∞–Ω–Ω—è GPS‚Ä¶';
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        instructionEl.innerText = '‚úÖ GPS –æ—Ç—Ä–∏–º–∞–Ω–æ';
                        if (gpsWatcher) navigator.geolocation.clearWatch(gpsWatcher);
                        gpsWatcher = navigator.geolocation.watchPosition(
                            (p) => {
                                const dist = calculateDistance(
                                    p.coords.latitude, p.coords.longitude,
                                    TARGET_LAT, TARGET_LON
                                );
                                updatePlanetVisibility(dist);
                            },
                            (err) => {
                                console.warn('watchPosition error:', err);
                                instructionEl.innerText = '‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ GPS';
                            },
                            { enableHighAccuracy: true, maximumAge: 2000, timeout: 10000 }
                        );
                    },
                    (err) => {
                        instructionEl.innerText = 'üîê –î–æ–∑–≤–æ–ª—å—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ GPS';
                        console.warn('getCurrentPosition error:', err);
                    },
                    { enableHighAccuracy: true, timeout: 15000 }
                );
            }

            // –ö–µ—Ä—É–≤–∞–Ω–Ω—è –∑–≤—É–∫–æ–º
            function toggleSound() {
                if (isSoundOn) {
                    bgMusic.pause();
                    soundBtn.innerHTML = 'üîä –ó–≤—É–∫';
                } else {
                    bgMusic.play().catch(e => {
                        console.warn('Audio play failed:', e);
                        showToast('–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å —â–µ —Ä–∞–∑ –¥–ª—è –∑–≤—É–∫—É', false);
                    });
                    soundBtn.innerHTML = 'üîá –í–∏–º–∫–Ω—É—Ç–∏';
                }
                isSoundOn = !isSoundOn;
            }

            // –†–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è –∞—É–¥—ñ–æ –Ω–∞ iOS (–ø–µ—Ä—à–∏–π –¥–æ—Ç–∏–∫)
            document.body.addEventListener('touchstart', function unlock() {
                if (!isSoundOn && bgMusic.paused) {
                    bgMusic.volume = 0.1;
                    bgMusic.play().then(() => {
                        bgMusic.pause();
                        bgMusic.volume = 0.5;
                    }).catch(() => {});
                }
                document.body.removeEventListener('touchstart', unlock);
            }, { once: true });

            // ======================== –õ–û–ì–Ü–ö–ê –í–Ü–ö–¢–û–†–ò–ù–ò ========================
            function showQuestion(index) {
                const q = questions[index];
                questionText.setAttribute('value', `${index+1}/12. ${q.q}`);
                answerAText.setAttribute('value', q.a);
                answerBText.setAttribute('value', q.b);
                // –°–∫–∏–¥–∞—î–º–æ —Å—Ç–∞–Ω
                answered = false;
                nextBtn.setAttribute('visible', 'false');
                // –†–æ–±–∏–º–æ –∫–Ω–æ–ø–∫–∏ –∑–Ω–æ–≤—É –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω–∏–º–∏ (–≤–æ–Ω–∏ –∑–∞–≤–∂–¥–∏ –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω—ñ, –∞–ª–µ –º–∏ –±–ª–æ–∫—É—î–º–æ –ª–æ–≥—ñ–∫–æ—é)
            }

            // –ì–ª–æ–±–∞–ª—å–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (–≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∑ onclick –≤ 3D)
            window.handleAnswer = function(selectedIdx) {
                if (answered) {
                    showToast('–í–∏ –≤–∂–µ –≤—ñ–¥–ø–æ–≤—ñ–ª–∏', false);
                    return;
                }
                const q = questions[currentQuestionIndex];
                const isCorrect = (selectedIdx === q.correct);
                if (isCorrect) {
                    showToast('‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!', true);
                    score++;
                } else {
                    showToast(`‚ùå –ü–æ–º–∏–ª–∫–∞. –ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${q.correct === 0 ? q.a : q.b}`, false);
                }
                answered = true;
                // –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É "–î–∞–ª—ñ"
                nextBtn.setAttribute('visible', 'true');
            };

            window.nextQuestion = function() {
                if (currentQuestionIndex < questions.length - 1) {
                    currentQuestionIndex++;
                    showQuestion(currentQuestionIndex);
                } else {
                    // –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç–µ—Å—Ç—É
                    showToast(`üéâ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö: ${score}/${questions.length}`, true);
                    quizContainer.setAttribute('visible', 'false');
                    quizBtn.classList.remove('active');
                    // –°–∫–∏–Ω—É—Ç–∏ —ñ–Ω–¥–µ–∫—Å –¥–ª—è –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä–∞–∑—É
                    currentQuestionIndex = 0;
                    score = 0;
                }
            };

            // –ü–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ –≤—ñ–∫—Ç–æ—Ä–∏–Ω—É
            quizBtn.addEventListener('click', () => {
                const visible = quizContainer.getAttribute('visible') === 'true';
                if (!visible) {
                    // –Ø–∫—â–æ –ø–ª–∞–Ω–µ—Ç–∞ –Ω–µ –≤–∏–¥–∏–º–∞ (–¥–∞–ª–µ–∫–æ), –º–æ–∂–Ω–∞ –Ω–µ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏, –∞–ª–µ –¥–æ–∑–≤–æ–ª–∏–º–æ
                    quizContainer.setAttribute('visible', 'true');
                    quizBtn.classList.add('active');
                    // –°–∫–∏–Ω—É—Ç–∏ –¥–æ –ø–µ—Ä—à–æ–≥–æ –ø–∏—Ç–∞–Ω–Ω—è
                    currentQuestionIndex = 0;
                    showQuestion(0);
                } else {
                    quizContainer.setAttribute('visible', 'false');
                    quizBtn.classList.remove('active');
                }
            });

            // –ö–Ω–æ–ø–∫–∞ –∑–≤—É–∫—É
            soundBtn.addEventListener('click', toggleSound);

            // –ö–Ω–æ–ø–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è GPS
            refreshBtn.addEventListener('click', () => {
                if (gpsWatcher) navigator.geolocation.clearWatch(gpsWatcher);
                startGPS();
            });

            // ======================== –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ========================
            window.addEventListener('load', () => {
                // –ó–∞–ø—É—Å–∫–∞—î–º–æ GPS, —è–∫—â–æ –Ω–µ DEV_MODE
                if (!DEV_MODE) {
                    startGPS();
                } else {
                    // –°–∏–º—É–ª—è—Ü—ñ—è
                    updatePlanetVisibility(12); // –≤ –º–µ–∂–∞—Ö –∑–æ–Ω–∏
                    instructionEl.innerText = 'üß™ –†–ï–ñ–ò–ú –¢–ï–°–¢–£ (–ø–ª–∞–Ω–µ—Ç–∞ –≤–∏–¥–∏–º–∞)';
                }

                // iOS –æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—è
                if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                    document.body.addEventListener('click', () => {
                        DeviceOrientationEvent.requestPermission().catch(console.warn);
                    }, { once: true });
                }

                // –°—Ö–æ–≤–∞—Ç–∏ –ª–æ–∞–¥–µ—Ä AR.js —á–µ—Ä–µ–∑ –¥–µ—è–∫–∏–π —á–∞—Å (–Ω–∞ –≤–∏–ø–∞–¥–æ–∫, —è–∫—â–æ –ø–æ–¥—ñ—è –Ω–µ —Å–ø—Ä–∞—Ü—é—î)
                setTimeout(() => {
                    const loader = document.querySelector('.arjs-loader');
                    if (loader) loader.style.display = 'none';
                }, 4000);
            });

            // –î–æ–¥–∞—Ç–∫–æ–≤–æ: –ø—Ä–∏—Ö–æ–≤—É—î–º–æ –ª–æ–∞–¥–µ—Ä –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è AR
            window.addEventListener('arjs-video-loaded', () => {
                const loader = document.querySelector('.arjs-loader');
                if (loader) loader.style.display = 'none';
            });

            // –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è –ø–æ–¥—ñ—ó (–º–æ–∂–µ –±—É—Ç–∏ –æ–ø–µ—á–∞—Ç–∫–∞ –≤ AR.js, –∞–ª–µ –¥–æ–¥–∞–º–æ –æ–±–∏–¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏)
            window.addEventListener('gps-entity-place-update-positon', (e) => {
                if (DEV_MODE) return;
                const dist = e.detail.distance;
                if (dist) updatePlanetVisibility(dist);
            });

            // –Ø–∫—â–æ –∫–ª—ñ–∫–Ω—É–ª–∏ –ø–æ–∑–∞ –º–µ–∂–∞–º–∏ –∫–Ω–æ–ø–æ–∫ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –Ω–∞ –ø–ª–∞–Ω–µ—Ç—É) ‚Äì –Ω—ñ—á–æ–≥–æ
        })();
    </script>
</body>
</html>
